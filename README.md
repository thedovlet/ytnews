# YTNews - Платформа для публикации объявлений

Веб-платформа для создания и просмотра объявлений с административной панелью для модераторов.

## Технологический стек

### Backend
- **FastAPI** - современный Python веб-фреймворк
- **PostgreSQL** - реляционная база данных
- **SQLAlchemy** - ORM
- **Alembic** - миграции БД
- **JWT** - аутентификация

### Frontend
- **React 18** + **TypeScript**
- **Vite** - сборщик
- **TailwindCSS** - стилизация
- **React Router** - маршрутизация
- **TanStack Query** - управление состоянием сервера
- **Zustand** - глобальное состояние
- **TipTap** - WYSIWYG редактор

## Структура проекта

```
ytnews/
├── backend/              # FastAPI приложение
│   ├── app/
│   │   ├── api/         # API endpoints
│   │   ├── core/        # Конфигурация, безопасность
│   │   ├── models/      # SQLAlchemy модели
│   │   ├── schemas/     # Pydantic схемы
│   │   └── crud/        # CRUD операции
│   ├── alembic/         # Миграции
│   └── requirements.txt
└── frontend/            # React приложение
    ├── src/
    │   ├── api/         # API клиенты
    │   ├── components/  # Компоненты
    │   ├── pages/       # Страницы
    │   ├── store/       # Zustand stores
    │   └── types/       # TypeScript типы
    └── package.json
```

## Установка и запуск

### Требования
- Python 3.9+
- Node.js 18+
- PostgreSQL 14+

### 1. Настройка базы данных

Создайте базу данных PostgreSQL:

```bash
createdb ytnews
```

### 2. Backend

```bash
cd backend

# Создайте виртуальное окружение
python -m venv venv

# Активируйте виртуальное окружение
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# Установите зависимости
pip install -r requirements.txt

# Создайте .env файл из примера
copy .env.example .env

# Отредактируйте .env и укажите настройки БД:
# DATABASE_URL=postgresql://user:password@localhost:5432/ytnews
# SECRET_KEY=ваш-секретный-ключ

# Примените миграции
alembic upgrade head

# Создайте первого администратора
python init_db.py

# Запустите сервер
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

Backend будет доступен по адресу: http://localhost:8000
API документация: http://localhost:8000/api/v1/docs

### 3. Frontend

```bash
cd frontend

# Установите зависимости
npm install

# Запустите dev-сервер
npm run dev
```

Frontend будет доступен по адресу: http://localhost:5173

## Создание первого администратора

При выполнении `python init_db.py` автоматически создается администратор:
- Email: `admin@ytnews.com`
- Password: `admin123`

**⚠️ ВАЖНО: Смените пароль после первого входа!**

## Основные функции

### Публичная часть
- Просмотр опубликованных объявлений
- Просмотр деталей объявления
- Регистрация и авторизация пользователей

### Административная панель (для модераторов/администраторов)
- Создание и редактирование объявлений
- Управление статусами (черновик, опубликовано, архив)
- Управление категориями
- Загрузка изображений

### Управление пользователями (только администраторы)
- Создание пользователей
- Назначение ролей
- Блокировка пользователей

## Роли пользователей

1. **USER** - обычный пользователь (просмотр объявлений)
2. **MODERATOR** - модератор (создание и управление объявлениями)
3. **ADMIN** - администратор (полный доступ, включая управление пользователями)

## API Endpoints

### Аутентификация
- `POST /api/v1/auth/register` - регистрация
- `POST /api/v1/auth/login` - вход
- `GET /api/v1/users/me` - текущий пользователь

### Объявления
- `GET /api/v1/announcements/` - опубликованные объявления
- `GET /api/v1/announcements/all` - все объявления (модераторы)
- `GET /api/v1/announcements/{id}` - объявление по ID
- `GET /api/v1/announcements/slug/{slug}` - объявление по slug
- `POST /api/v1/announcements/` - создать объявление (модераторы)
- `PUT /api/v1/announcements/{id}` - обновить объявление (модераторы)
- `DELETE /api/v1/announcements/{id}` - удалить объявление (модераторы)

### Категории
- `GET /api/v1/categories/` - все категории
- `POST /api/v1/categories/` - создать категорию (модераторы)
- `PUT /api/v1/categories/{id}` - обновить категорию (модераторы)
- `DELETE /api/v1/categories/{id}` - удалить категорию (модераторы)

### Пользователи
- `GET /api/v1/users/` - все пользователи (администраторы)
- `POST /api/v1/users/` - создать пользователя (администраторы)
- `PUT /api/v1/users/{id}` - обновить пользователя (администраторы)
- `DELETE /api/v1/users/{id}` - удалить пользователя (администраторы)

### Загрузка файлов
- `POST /api/v1/upload/image` - загрузить изображение (модераторы)
- `POST /api/v1/upload/images` - загрузить несколько изображений (модераторы)

## Разработка

### Backend

Для создания новой миграции:

```bash
alembic revision --autogenerate -m "описание изменений"
alembic upgrade head
```

### Frontend

Сборка для продакшена:

```bash
npm run build
```

## Безопасность

- Все пароли хешируются с использованием bcrypt
- JWT токены для аутентификации
- Защита от XSS и SQL-инъекций
- CORS настроен для разрешенных источников
- Валидация данных на уровне Pydantic

## Реализованный функционал

### ✅ Backend
- Полная система аутентификации с JWT
- Модели данных: Users, Announcements, Categories
- CRUD API для всех сущностей
- Роли пользователей и защита endpoints
- Загрузка изображений
- Миграции базы данных

### ✅ Frontend
- Публичные страницы (главная, просмотр объявления)
- Авторизация и регистрация
- Административная панель:
  - Список объявлений с фильтрами
  - Форма создания/редактирования с TipTap редактором
  - Управление категориями
  - Управление пользователями (для администраторов)
- Автоматическая генерация slug из заголовка
- Защита маршрутов по ролям

## Возможные улучшения

1. **Дополнительные функции:**
   - Поиск по объявлениям
   - Фильтрация по категориям на главной странице
   - Пагинация списков
   - Превью изображений перед загрузкой
   - Drag & drop для загрузки файлов
   - Rich text валидация

2. **Оптимизация:**
   - Кеширование с Redis
   - Оптимизация изображений (thumbnails)
   - Lazy loading изображений
   - SEO оптимизация (meta tags, sitemap)
   - Rate limiting для API

3. **UX улучшения:**
   - Уведомления (toast notifications)
   - Подтверждение несохраненных изменений
   - Автосохранение черновиков
   - Markdown поддержка
   - Экспорт/импорт данных

## Лицензия

MIT
